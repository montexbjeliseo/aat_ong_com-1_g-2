{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="flex-wrap mx-4">
    <div class="h2">
        {% if noticia.categoria %}
        {{noticia.categoria}}
        {% else %}
        Sin categor√≠a
        {% endif %}
    </div>
    <div class="h1">{{noticia.titulo}}
        {% if user.is_authenticated and user.is_superuser %}
        <a href="{{noticia.get_link_editar}}" class="btn btn-success">Editar</a>
        {% endif %}
    </div>
    <small class="text-muted">
        {% if noticia.autor %}
        {{noticia.autor}}
        {% else %}
        An&oacute;nimo
        {% endif %}
        | {{noticia.creado}}</small>
    <div>
        {% if noticia.imagen %}
        <img src="{{noticia.imagen.url}}" alt="{{noticia.titulo}}" width="100%">
        {% endif %}
    </div>
    <div>{{noticia.cuerpo | safe}}</div>
    <div>
        <h4>Comentarios</h4>
        {% if noticia.comentario_set.all %}
        {% for comentario in noticia.comentario_set.all %}
        <form id="id_texto{{comentario.pk}}" action="{{comentario.get_link_editar}}" method="POST" class="d-none">
            {% csrf_token %}
            <textarea name="texto" class="form-control"
                rows="4">{{comentario.texto}}</textarea>
            <button class="btn btn-primary" type="submit">Guardar</button>
            <button class="btn btn-danger" type="reset" onclick="cancelar_edicion('{{comentario.pk}}');">Cancelar</button>
        </form>
        <div class="border" id="id_comentario{{comentario.pk}}">
            <div>{{comentario.texto}}</div>
            <div>
                <small class="text-muted">
                    <b>{{comentario.usuario}}</b> | {{comentario.modificado}}
                    {% if comentario.editado %}
                    | <b>Editado</b> 
                    {% endif %}
                    {% if user.is_authenticated and user == comentario.usuario %}
                    | <a href="javascript:editar({{comentario.pk}});"><b>Editar</b></a>
                    {% endif %}
                </small>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <i>No hay comentarios, se el primero!</i>
        {% endif %}
        <hr>
        {% if user.is_authenticated %}
        <form action="{{noticia.get_link_comentar}}" method="post">
            {% csrf_token %}
            {{ comment_form }}
            <button class="btn btn-primary" type="submit">Comentar</button>
        </form>
        {% else %}
        <p><a href="{% url 'login'%}?next={{request.path}}">Inicia sesi&oacute;n</a> para comentar</p>
        {% endif %}
    </div>
</div>
<script src="{% static 'js/comentario.js' %}" type="text/javascript"></script>
{% endblock content %}